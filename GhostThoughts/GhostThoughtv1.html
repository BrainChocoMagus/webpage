<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ghost Thoughts</title>
  <link rel="stylesheet" href="ghost-style.css"> <!-- keep your CSS separate for readability -->
  
  <!-- Supabase client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://Ghostthought.supabase.co"; // replace
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1ma3JraG12cXl0aGthbHNma2NtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4MjU5MjYsImV4cCI6MjA3MTQwMTkyNn0.OYjwJrb2YHSMEo4bdtjz9A2mopDzSjeH8jq9HTxtmuU"; // replace
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
  </script>
</head>
<body>
  <div class="header">
    <h1>Ghost Thoughts</h1>
    <p class="subtitle">Your thoughts float around like ghosts with different moods</p>
  </div>

  <div class="container">
    <div class="instructions">
      <p>These ghosts represent your saved thoughts, each with a different mood. Hover over a ghost to see the thought, and click to keep it visible.</p>
    </div>

    <div class="button-group">
      <button class="addBtn" id="addThoughtBtn">+</button>
      <button class="spawnBtn" id="spawnThoughtBtn">üëª</button>
      <button class="clearBtn" id="clearThoughtsBtn">üóëÔ∏è</button>
    </div>

    <div id="thoughtForm" class="thought-form">
      <h3>Add a Thought</h3>
      <input type="text" id="thoughtTitle" placeholder="Title (optional)">

      <div class="html-toggle">
        <input type="checkbox" id="htmlToggle">
        <label for="htmlToggle">Create extended post with HTML</label>
      </div>

      <div id="simpleText">
        <textarea id="thoughtText" placeholder="What's on your mind?"></textarea>
      </div>

      <div id="htmlEditor" class="html-editor">
        <textarea id="htmlContent" placeholder="Write your HTML content here..."></textarea>
      </div>

      <label class="mood-label">Select Mood:</label>
      <select id="moodSelect">
        <option value="joy">Joy üòä</option>
        <option value="sadness">Sadness üò¢</option>
        <option value="anger">Anger üò†</option>
        <option value="fear">Fear üò®</option>
        <option value="disgust">Disgust üòí</option>
        <option value="inlove">In Love üòç</option>
        <option value="other">Other Mood</option>
      </select>

      <div id="customMood" class="custom-mood">
        <input type="text" id="customMoodName" placeholder="Mood name (optional)">
        <input type="text" id="customMoodEmoji" placeholder="Emoji (optional, e.g., üòé)">
      </div>

      <div class="form-controls">
        <button id="cancelBtn">Cancel</button>
        <button id="submitBtn">Save Thought</button>
      </div>
    </div>

    <div id="message" class="message">
      <p>No thoughts yet. Add your own using the + button.</p>
    </div>
  </div>

  <!-- Blog Overlay -->
  <div id="blogOverlay" class="blog-overlay">
    <div class="blog-content">
      <div class="blog-close" id="blogClose">X</div>
      <div class="blog-header">
        <div id="blogGhost" class="blog-ghost">
          <div class="ghost-body"></div>
          <div class="ghost-eyes"><div class="ghost-eye"></div><div class="ghost-eye"></div></div>
          <div class="ghost-mouth"></div>
          <div class="ghost-skirt"><div class="ghost-fold"></div><div class="ghost-fold"></div><div class="ghost-fold"></div></div>
          <div class="heart"></div>
        </div>
        <div>
          <h2 id="blogMood" class="blog-mood"></h2>
          <div id="blogDate" class="blog-date"></div>
        </div>
      </div>
      <h2 id="blogTitle" class="blog-title"></h2>
      <div id="blogText" class="blog-text"></div>
      <div id="blogHtml" class="blog-html-content"></div>
    </div>
  </div>

  <footer>
    <p>Hover over ghosts to see thoughts. Click to view full post.</p>
  </footer>

  <script>
    // --- Supabase CRUD helpers ---
    async function saveThought(thought) {
      const { error } = await supabase.from('thoughts').insert([thought]);
      if (error) console.error('Save error:', error);
    }

    async function loadThoughts() {
      const { data, error } = await supabase.from('thoughts').select('*').order('created_at', { ascending: false });
      if (error) { console.error('Load error:', error); return []; }
      return data;
    }

    async function clearThoughts() {
      const { error } = await supabase.from('thoughts').delete().neq('id', 0);
      if (error) console.error('Clear error:', error);
    }

    // --- UI Logic (shortened for clarity, reuse your existing functions) ---
    const addThoughtBtn = document.getElementById('addThoughtBtn');
    const spawnThoughtBtn = document.getElementById('spawnThoughtBtn');
    const clearThoughtsBtn = document.getElementById('clearThoughtsBtn');
    const submitBtn = document.getElementById('submitBtn');
    const cancelBtn = document.getElementById('cancelBtn');

    addThoughtBtn.addEventListener('click', () => {
      document.getElementById('thoughtForm').classList.toggle('show');
    });

    cancelBtn.addEventListener('click', () => {
      document.getElementById('thoughtForm').classList.remove('show');
    });

    submitBtn.addEventListener('click', async () => {
      const thought = {
        title: document.getElementById('thoughtTitle').value,
        text: document.getElementById('thoughtText').value,
        html_content: document.getElementById('htmlContent').value,
        mood: document.getElementById('moodSelect').value,
        custom_mood: {
          name: document.getElementById('customMoodName').value,
          emoji: document.getElementById('customMoodEmoji').value
        }
      };
      thought.date = new Date().toLocaleDateString();
      await saveThought(thought);
      createGhost(thought);
      document.getElementById('thoughtForm').classList.remove('show');
    });

    spawnThoughtBtn.addEventListener('click', async () => {
      const saved = await loadThoughts();
      if (saved.length > 0) {
        const randomThought = saved[Math.floor(Math.random() * saved.length)];
        createGhost(randomThought);
      } else {
        document.getElementById('message').classList.add('show');
      }
    });

    clearThoughtsBtn.addEventListener('click', async () => {
      await clearThoughts();
      document.querySelectorAll('.ghost-container').forEach(el => el.remove());
    });

    // --- include your existing createGhost(), showBlogView(), etc. here ---
  </script>
</body>
</html>
